
R : Copyright 2005, The R Foundation for Statistical Computing
Version 2.2.1 beta (2005-12-18 r36792)
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ###################################################
> ### chunk number 1: setup
> ###################################################
> rm(list = ls())
> if (!file.exists("tables")) dir.create("tables")
> set.seed(290875)
> options(prompt = "R> ", width = 63, # digits = 4,
+     SweaveHooks = list(leftpar = function()
+         par(mai = par("mai") * c(1, 1.05, 1, 1))))
R> HSAURpkg <- require("HSAUR")
Loading required package: HSAUR
Loading required package: lattice
Loading required package: MASS
Loading required package: scatterplot3d
R> if (!HSAURpkg) stop("cannot load package ", sQuote("HSAUR"))
R> rm(HSAURpkg)
R> 
R> 
R> ###################################################
R> ### chunk number 2: CI-roomwidth-ties
R> ###################################################
R> data("roomwidth", package = "HSAUR")
R> nobs <- table(roomwidth$unit)
R> ties <- tapply(roomwidth$width, roomwidth$unit, function(x) length(x) - length(unique(x)))
R> library("coin")
Loading required package: survival
Loading required package: splines
Loading required package: mvtnorm
Loading required package: modeltools
R> 
R> 
R> ###################################################
R> ### chunk number 3: CI-roomwidth-data
R> ###################################################
R> data("roomwidth", package = "HSAUR")
R> convert <- ifelse(roomwidth$unit == "feet", 1, 3.28)
R> feet <- roomwidth$unit == "feet"
R> metre <- !feet
R> y <- roomwidth$width * convert
R> 
R> 
R> ###################################################
R> ### chunk number 4: CI-roomwidth-teststat
R> ###################################################
R> T <- mean(y[feet]) - mean(y[metre])
R> T
[1] -8.858893
R> 
R> 
R> ###################################################
R> ### chunk number 5: CI-roomwidth-permutation
R> ###################################################
R> meandiffs <- double(9999)
R> for (i in 1:length(meandiffs)) {
+     sy <- sample(y)
+     meandiffs[i] <- mean(sy[feet]) - mean(sy[metre])
+ }
R> 
R> 
R> ###################################################
R> ### chunk number 6: CI-roomwidth-plot
R> ###################################################
R> hist(meandiffs)
R> abline(v = T, lty = 2)
R> abline(v = -T, lty = 2)
R> 
R> 
R> ###################################################
R> ### chunk number 7: CI-roomwidth-pvalue
R> ###################################################
R> greater <- abs(meandiffs) > abs(T)
R> mean(greater)
[1] 0.00790079
R> 
R> 
R> ###################################################
R> ### chunk number 8: CI-roomwidth-pvalue
R> ###################################################
R> binom.test(sum(greater), length(greater))$conf.int
[1] 0.006259976 0.009837149
attr(,"conf.level")
[1] 0.95
R> 
R> 
R> ###################################################
R> ### chunk number 9: CI-roomwidth-coin
R> ###################################################
R> library("coin")
R> independence_test(y ~ unit, data = roomwidth, distribution = "exact")

	Exact General Independence Test

data:  y by groups feet, metres 
T = -2.5491, p-value = 0.008492
alternative hypothesis: two.sided 

R> 
R> 
R> ###################################################
R> ### chunk number 10: CI-roomwidth-coin
R> ###################################################
R> wilcox_test(y ~ unit, data = roomwidth, distribution = "exact")

	Exact Wilcoxon Mann-Whitney Rank Sum Test

data:  y by groups feet, metres 
T = -2.1981, p-value = 0.02763
alternative hypothesis: true mu is not equal to 0 

R> 
R> 
R> ###################################################
R> ### chunk number 11: CI-suicides-ft
R> ###################################################
R> data("suicides", package = "HSAUR")
R> fisher.test(suicides)

	Fisher's Exact Test for Count Data

data:  suicides 
p-value = 0.0805
alternative hypothesis: true odds ratio is not equal to 1 
95 percent confidence interval:
  0.7306872 91.0288231 
sample estimates:
odds ratio 
  6.302622 

R> 
R> 
R> ###################################################
R> ### chunk number 12: CI-suicides-chisq
R> ###################################################
R> ftp <- round(fisher.test(suicides)$p.value, 3)
R> ctp <- round(chisq.test(suicides)$p.value, 3)
Warning message:
Chi-squared approximation may be incorrect in: chisq.test(suicides) 
R> 
R> 
R> ###################################################
R> ### chunk number 13: CI-Lanza-data
R> ###################################################
R> data("Lanza", package = "HSAUR")
R> xtabs(~ treatment + classification + study, data = Lanza)
, , study = I

             classification
treatment      1  2  3  4  5
  Misoprostol 21  2  4  2  0
  Placebo      2  2  4  9 13

, , study = II

             classification
treatment      1  2  3  4  5
  Misoprostol 20  4  6  0  0
  Placebo      8  4  9  4  5

, , study = III

             classification
treatment      1  2  3  4  5
  Misoprostol 20  4  3  1  2
  Placebo      0  2  5  5 17

, , study = IV

             classification
treatment      1  2  3  4  5
  Misoprostol  1  4  5  0  0
  Placebo      0  0  0  4  6

R> 
R> 
R> ###################################################
R> ### chunk number 14: CI-width
R> ###################################################
R> options(width = 65)
R> 
R> 
R> ###################################################
R> ### chunk number 15: CI-Lanza-singleI
R> ###################################################
R> library("coin")
R> cmh_test(classification ~ treatment, data = Lanza,
+          scores = list(classification = c(0, 1, 6, 17, 30)),
+          subset = Lanza$study == "I")

	Asymptotic Linear-by-Linear Association Test

data:  classification (ordered) by groups Misoprostol, Placebo 
T = 28.8478, df = 1, p-value = 7.83e-08

R> 
R> 
R> ###################################################
R> ### chunk number 16: CI-Lanza-singleII
R> ###################################################
R> cmh_test(classification ~ treatment, data = Lanza,
+          scores = list(classification = c(0, 1, 6, 17, 30)),
+          subset = Lanza$study == "II")

	Asymptotic Linear-by-Linear Association Test

data:  classification (ordered) by groups Misoprostol, Placebo 
T = 12.0641, df = 1, p-value = 0.000514

R> 
R> 
R> ###################################################
R> ### chunk number 17: CI-Lanza-singleIIa
R> ###################################################
R> p <- cmh_test(classification ~ treatment, data = Lanza,
+          scores = list(classification = c(0, 1, 6, 17, 30)),
+          subset = Lanza$study == "II", distribution =
+          approximate(B = 19999))
R> pvalue(p)
[1] 5.00025e-05
99 percent confidence interval:
 2.506396e-07 3.714653e-04 

R> 
R> 
R> ###################################################
R> ### chunk number 18: CI-Lanza-singleIII-IV
R> ###################################################
R> cmh_test(classification ~ treatment, data = Lanza,
+          scores = list(classification = c(0, 1, 6, 17, 30)),
+          subset = Lanza$study == "III")

	Asymptotic Linear-by-Linear Association Test

data:  classification (ordered) by groups Misoprostol, Placebo 
T = 28.1587, df = 1, p-value = 1.118e-07

R> cmh_test(classification ~ treatment, data = Lanza,
+          scores = list(classification = c(0, 1, 6, 17, 30)),
+          subset = Lanza$study == "IV")

	Asymptotic Linear-by-Linear Association Test

data:  classification (ordered) by groups Misoprostol, Placebo 
T = 15.7414, df = 1, p-value = 7.262e-05

R> 
R> 
R> ###################################################
R> ### chunk number 19: CI-Lanza-all
R> ###################################################
R> cmh_test(classification ~ treatment | study, data = Lanza,
+          scores = list(classification = c(0, 1, 6, 17, 30)))

	Asymptotic Linear-by-Linear Association Test

data:  classification (ordered) by
	 groups Misoprostol, Placebo 
	 stratified by study 
T = 83.6188, df = 1, p-value < 2.2e-16

R> 
R> 
R> ###################################################
R> ### chunk number 20: CI-anomalies
R> ###################################################
R> anomalies <- as.table(matrix(c(235, 23, 3, 0, 41, 35, 8, 0, 20, 11, 11, 1, 2, 1, 3, 1),
+ ncol = 4, dimnames = list(MD = 0:3, RA = 0:3)))
R> anomalies
   RA
MD    0   1   2   3
  0 235  41  20   2
  1  23  35  11   1
  2   3   8  11   3
  3   0   0   1   1
R> 
R> 
R> ###################################################
R> ### chunk number 21: CI-anomalies-mh
R> ###################################################
R> mh_test(anomalies)

	Asymptotic Marginal-Homogenity Test

data:  response by
	 groups MD, RA 
	 stratified by block 
T = 21.2266, df = 3, p-value = 9.446e-05

R> 
R> 
R> ###################################################
R> ### chunk number 22: CI-anomalies-ordered
R> ###################################################
R> mh_test(anomalies, scores = list(c(0, 1, 2, 3)))

	Asymptotic Marginal-Homogenity Test for Ordered Data

data:  response (ordered) by
	 groups MD, RA 
	 stratified by block 
T = 21.0199, df = 1, p-value = 4.545e-06

R> 
R> 
R> 
