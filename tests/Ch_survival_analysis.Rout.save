
R : Copyright 2005, The R Foundation for Statistical Computing
Version 2.2.1 beta (2005-12-18 r36792)
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ###################################################
> ### chunk number 1: setup
> ###################################################
> rm(list = ls())
> if (!file.exists("tables")) dir.create("tables")
> set.seed(290875)
> options(prompt = "R> ", width = 63, # digits = 4,
+     SweaveHooks = list(leftpar = function()
+         par(mai = par("mai") * c(1, 1.05, 1, 1))))
R> HSAURpkg <- require("HSAUR")
Loading required package: HSAUR
Loading required package: lattice
Loading required package: MASS
Loading required package: scatterplot3d
R> if (!HSAURpkg) stop("cannot load package ", sQuote("HSAUR"))
R> rm(HSAURpkg)
R> 
R> 
R> ###################################################
R> ### chunk number 2: SA-setup
R> ###################################################
R> x <- library("survival")
Loading required package: splines
R> x <- library("coin")
Loading required package: mvtnorm
Loading required package: modeltools
R> x <- library("party")
Loading required package: grid
R> 
R> 
R> ###################################################
R> ### chunk number 3: SA-glioma-KM
R> ###################################################
R> data("glioma", package = "coin")
R> library("survival")
R> layout(matrix(1:2, ncol = 2))
R> g3 <- subset(glioma, histology == "Grade3")
R> plot(survfit(Surv(time, event) ~ group, data = g3),
+       main = "Grade III Glioma",
+       lty = c(2, 1),
+       ylab = "Probability",
+       xlab = "Survival Time in Month",
+       legend.bty = "n", legend.text = c("Control", "Treated")
+ )
R> g4 <- subset(glioma, histology == "GBM")
R> plot(survfit(Surv(time, event) ~ group, data = g4),
+      main = "Grade IV Glioma", ylab = "Probability", lty = c(2, 1),
+      xlab = "Survival Time in Month", xlim = c(0, max(glioma$time) * 1.05))
R> 
R> 
R> ###################################################
R> ### chunk number 4: SA-glioma-logrank
R> ###################################################
R> survdiff(Surv(time, event) ~ group, data = g3)
Call:
survdiff(formula = Surv(time, event) ~ group, data = g3)

               N Observed Expected (O-E)^2/E (O-E)^2/V
group=Control  6        4     1.49      4.23      6.06
group=RIT     11        2     4.51      1.40      6.06

 Chisq= 6.1  on 1 degrees of freedom, p= 0.0138 
R> 
R> 
R> ###################################################
R> ### chunk number 5: SA-glioma-exact
R> ###################################################
R> library("coin")
R> surv_test(Surv(time, event) ~ group, data = g3,
+           distribution = "exact")

	Exact Logrank Test

data:  Surv(time, event) by groups Control, RIT 
T = 2.1711, p-value = 0.02877
alternative hypothesis: two.sided 

R> 
R> 
R> ###################################################
R> ### chunk number 6: SA-glioma-g4
R> ###################################################
R> surv_test(Surv(time, event) ~ group, data = g4,
+                   distribution = "exact")

	Exact Logrank Test

data:  Surv(time, event) by groups Control, RIT 
T = 3.2215, p-value = 0.0001588
alternative hypothesis: two.sided 

R> 
R> 
R> ###################################################
R> ### chunk number 7: SA-glioma-hist
R> ###################################################
R> surv_test(Surv(time, event) ~ group | histology, data = glioma,
+           distribution = approximate(B = 10000))

	Approximative Logrank Test

data:  Surv(time, event) by
	 groups Control, RIT 
	 stratified by histology 
T = 3.6704, p-value = 1e-04
alternative hypothesis: two.sided 

R> 
R> 
R> ###################################################
R> ### chunk number 8: SA-GBSG2-plot
R> ###################################################
R> data("GBSG2", package = "ipred")
R> plot(survfit(Surv(time, cens) ~ horTh, data = GBSG2), lty = 1:2,
+      mark.time = FALSE,
+      ylab = "Probability", xlab = "Survival Time in Days")
R> legend(250, 0.2, legend = c("yes", "no"), lty = c(2, 1),
+        title = "Hormonal Therapy", bty = "n")
R> 
R> 
R> ###################################################
R> ### chunk number 9: SA-GBSG2-coxph
R> ###################################################
R> GBSG2_coxph <- coxph(Surv(time, cens) ~ ., data = GBSG2)
R> 
R> 
R> ###################################################
R> ### chunk number 10: SA-GBSG2-coxph-ci
R> ###################################################
R> ci <- confint(GBSG2_coxph)
R> exp(cbind(coef(GBSG2_coxph), ci))["horThyes",]
              2.5 %    97.5 % 
0.7073155 0.5492178 0.9109233 
R> 
R> 
R> ###################################################
R> ### chunk number 11: GBSG2-coxph-summary
R> ###################################################
R> summary(GBSG2_coxph)
Call:
coxph(formula = Surv(time, cens) ~ ., data = GBSG2)

  n= 686 
                  coef exp(coef) se(coef)      z       p
horThyes     -0.346278     0.707 0.129075 -2.683 7.3e-03
age          -0.009459     0.991 0.009301 -1.017 3.1e-01
menostatPost  0.258445     1.295 0.183476  1.409 1.6e-01
tsize         0.007796     1.008 0.003939  1.979 4.8e-02
tgrade.L      0.551299     1.736 0.189844  2.904 3.7e-03
tgrade.Q     -0.201091     0.818 0.121965 -1.649 9.9e-02
pnodes        0.048789     1.050 0.007447  6.551 5.7e-11
progrec      -0.002217     0.998 0.000574 -3.866 1.1e-04
estrec        0.000197     1.000 0.000450  0.438 6.6e-01

             exp(coef) exp(-coef) lower .95 upper .95
horThyes         0.707      1.414     0.549     0.911
age              0.991      1.010     0.973     1.009
menostatPost     1.295      0.772     0.904     1.855
tsize            1.008      0.992     1.000     1.016
tgrade.L         1.736      0.576     1.196     2.518
tgrade.Q         0.818      1.223     0.644     1.039
pnodes           1.050      0.952     1.035     1.065
progrec          0.998      1.002     0.997     0.999
estrec           1.000      1.000     0.999     1.001

Rsquare= 0.142   (max possible= 0.995 )
Likelihood ratio test= 105  on 9 df,   p=0
Wald test            = 115  on 9 df,   p=0
Score (logrank) test = 121  on 9 df,   p=0

R> 
R> 
R> ###################################################
R> ### chunk number 12: SA-GBSG2-zph
R> ###################################################
R> GBSG2_zph <- cox.zph(GBSG2_coxph)
R> GBSG2_zph
                   rho    chisq       p
horThyes     -2.54e-02 1.96e-01 0.65778
age           9.40e-02 2.96e+00 0.08552
menostatPost -1.19e-05 3.75e-08 0.99985
tsize        -2.50e-02 1.88e-01 0.66436
tgrade.L     -1.30e-01 4.85e+00 0.02772
tgrade.Q      3.22e-03 3.14e-03 0.95530
pnodes        5.84e-02 5.98e-01 0.43941
progrec       5.65e-02 1.20e+00 0.27351
estrec        5.46e-02 1.03e+00 0.30967
GLOBAL              NA 2.27e+01 0.00695
R> 
R> 
R> ###################################################
R> ### chunk number 13: SA-GBSG2-zph-plot
R> ###################################################
R> plot(GBSG2_zph, var = "age")
Warning messages:
1: collapsing to unique 'x' values in: approx(xx, xtime, seq(min(xx), max(xx), length = 17)[2 * (1:8)]) 
2: collapsing to unique 'x' values in: approx(xtime, xx, temp) 
R> 
R> 
R> ###################################################
R> ### chunk number 14: SA-GBSG2-Martingal
R> ###################################################
R> layout(matrix(1:3, ncol = 3))
R> res <- residuals(GBSG2_coxph)
R> plot(res ~ age, data = GBSG2, ylim = c(-2.5, 1.5), pch = ".", ylab = "Martingale Residuals")
R> abline(h = 0, lty = 3)
R> plot(res ~ pnodes, data = GBSG2, ylim = c(-2.5, 1.5), pch = ".", ylab = "")
R> abline(h = 0, lty = 3)
R> plot(res ~ log(progrec), data = GBSG2, ylim = c(-2.5, 1.5), pch = ".", ylab = "")
R> abline(h = 0, lty = 3)
R> 
R> 
R> ###################################################
R> ### chunk number 15: SA-GBSG2-ctree
R> ###################################################
R> GBSG2_ctree <- ctree(Surv(time, cens) ~ ., data = GBSG2)
R> 
R> 
R> ###################################################
R> ### chunk number 16: SA-GBSG2-ctree-plot
R> ###################################################
R> plot(GBSG2_ctree)
R> 
R> 
R> 
