
R : Copyright 2006, The R Foundation for Statistical Computing
Version 2.3.0 (2006-04-24)
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ###################################################
> ### chunk number 1: setup
> ###################################################
> rm(list = ls())
> if (!file.exists("tables")) dir.create("tables")
> set.seed(290875)
> options(prompt = "R> ", width = 63, # digits = 4,
+     SweaveHooks = list(leftpar = function()
+         par(mai = par("mai") * c(1, 1.05, 1, 1))))
R> HSAURpkg <- require("HSAUR")
Loading required package: HSAUR
Loading required package: lattice
Loading required package: MASS
Loading required package: scatterplot3d
R> if (!HSAURpkg) stop("cannot load package ", sQuote("HSAUR"))
R> rm(HSAURpkg)
R> 
R> 
R> ###################################################
R> ### chunk number 2: MA-smoking-
R> ###################################################
R> library("rmeta")
Loading required package: grid
R> data("smoking", package = "HSAUR")
R> smokingOR <- meta.MH(smoking[["tt"]], smoking[["tc"]],
+                      smoking[["qt"]], smoking[["qc"]],
+                      names = rownames(smoking))
R> 
R> 
R> ###################################################
R> ### chunk number 3: MA-smoking-OR-summary
R> ###################################################
R> summary(smokingOR)
Fixed effects ( Mantel-Haenszel ) meta-analysis
Call: meta.MH(ntrt = smoking[["tt"]], nctrl = smoking[["tc"]], ptrt = smoking[["qt"]], 
    pctrl = smoking[["qc"]], names = rownames(smoking))
------------------------------------
               OR (lower  95% upper)
Blondal89    1.85    0.99       3.46
Campbell91   0.98    0.50       1.92
Fagerstrom82 1.76    0.80       3.89
Fee82        1.53    0.77       3.05
Garcia89     2.95    1.01       8.62
Garvey00     2.49    1.43       4.34
Gross95      2.62    1.03       6.71
Hall85       2.03    0.78       5.29
Hall87       2.82    1.33       5.99
Hall96       0.87    0.46       1.64
Hjalmarson84 2.17    1.10       4.28
Huber88      6.00    2.57      14.01
Jarvis82     3.33    1.37       8.08
Jensen91     1.43    0.84       2.44
Killen84     1.33    0.43       4.15
Killen90     1.23    0.93       1.64
Malcolm80    3.52    0.85      14.54
McGovern92   1.17    0.70       1.94
Nakamura90   3.82    1.15      12.71
Niaura94     1.34    0.35       5.19
Pirie92      1.84    1.20       2.82
Puska79      1.46    0.78       2.75
Schneider85  1.71    0.52       5.62
Tonnesen88   2.12    0.93       4.86
Villa99      1.76    0.55       5.64
Zelman92     1.46    0.68       3.14
------------------------------------
Mantel-Haenszel OR =1.67 95% CI ( 1.47,1.9 )
Test for heterogeneity: X^2( 25 ) = 34.9 ( p-value 0.09 )
R> 
R> 
R> ###################################################
R> ### chunk number 4: MA-smoking-OR-plot
R> ###################################################
R> plot(smokingOR, ylab = "")
R> 
R> 
R> ###################################################
R> ### chunk number 5: MA-smoking-random
R> ###################################################
R> smokingDSL <- meta.DSL(smoking[["tt"]], smoking[["tc"]],
+                      smoking[["qt"]], smoking[["qc"]],
+                      names = rownames(smoking))
R> print(smokingDSL)
Random effects ( DerSimonian-Laird ) meta-analysis
Call: meta.DSL(ntrt = smoking[["tt"]], nctrl = smoking[["tc"]], ptrt = smoking[["qt"]], 
    pctrl = smoking[["qc"]], names = rownames(smoking))
Summary OR= 1.75    95% CI ( 1.48, 2.07 )
Estimated random effects variance: 0.05 
R> 
R> 
R> ###################################################
R> ### chunk number 6: MA-BCG-odds
R> ###################################################
R> data("BCG", package = "HSAUR")
R> BCG_OR <- meta.MH(BCG[["BCGVacc"]], BCG[["NoVacc"]],
+                   BCG[["BCGTB"]], BCG[["NoVaccTB"]],
+                   names = BCG$Study)
R> BCG_DSL <- meta.DSL(BCG[["BCGVacc"]], BCG[["NoVacc"]],
+                   BCG[["BCGTB"]], BCG[["NoVaccTB"]],
+                   names = BCG$Study)
R> 
R> 
R> ###################################################
R> ### chunk number 7: MA-BCGOR-summary
R> ###################################################
R> summary(BCG_OR)
Fixed effects ( Mantel-Haenszel ) meta-analysis
Call: meta.MH(ntrt = BCG[["BCGVacc"]], nctrl = BCG[["NoVacc"]], ptrt = BCG[["BCGTB"]], 
    pctrl = BCG[["NoVaccTB"]], names = BCG$Study)
------------------------------------
     OR (lower  95% upper)
1  0.39    0.12       1.26
2  0.19    0.08       0.46
3  0.25    0.07       0.91
4  0.23    0.18       0.31
5  0.80    0.51       1.26
6  0.38    0.32       0.47
7  0.20    0.08       0.50
8  1.01    0.89       1.15
9  0.62    0.39       1.00
10 0.25    0.14       0.42
11 0.71    0.57       0.89
12 1.56    0.37       6.55
13 0.98    0.58       1.66
------------------------------------
Mantel-Haenszel OR =0.62 95% CI ( 0.57,0.68 )
Test for heterogeneity: X^2( 12 ) = 163.94 ( p-value 0 )
R> 
R> 
R> ###################################################
R> ### chunk number 8: MA-BCGDSL-summary
R> ###################################################
R> summary(BCG_DSL)
Random effects ( DerSimonian-Laird ) meta-analysis
Call: meta.DSL(ntrt = BCG[["BCGVacc"]], nctrl = BCG[["NoVacc"]], ptrt = BCG[["BCGTB"]], 
    pctrl = BCG[["NoVaccTB"]], names = BCG$Study)
------------------------------------
     OR (lower  95% upper)
1  0.39    0.12       1.26
2  0.19    0.08       0.46
3  0.25    0.07       0.91
4  0.23    0.18       0.31
5  0.80    0.51       1.26
6  0.38    0.32       0.47
7  0.20    0.08       0.50
8  1.01    0.89       1.15
9  0.62    0.39       1.00
10 0.25    0.14       0.42
11 0.71    0.57       0.89
12 1.56    0.37       6.55
13 0.98    0.58       1.66
------------------------------------
SummaryOR= 0.47  95% CI ( 0.32,0.69 )
Test for heterogeneity: X^2( 12 ) = 163.16 ( p-value 0 )
Estimated random effects variance: 0.37 
R> 
R> 
R> ###################################################
R> ### chunk number 9: BCG-studyweights
R> ###################################################
R> studyweights <- 1 / (BCG_DSL$tau2 + BCG_DSL$selogs)
R> y <- BCG_DSL$logs
R> BCG_mod <- lm(y ~ Latitude + Year, data = BCG, weights = studyweights)
R> 
R> 
R> ###################################################
R> ### chunk number 10: MA-mod-summary
R> ###################################################
R> summary(BCG_mod)

Call:
lm(formula = y ~ Latitude + Year, data = BCG, weights = studyweights)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.40868 -0.33622 -0.04847  0.25412  1.13362 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)  
(Intercept) -14.521025  37.178382  -0.391   0.7043  
Latitude     -0.026463   0.013553  -1.953   0.0794 .
Year          0.007442   0.018755   0.397   0.6998  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1 

Residual standard error: 0.6862 on 10 degrees of freedom
Multiple R-Squared:  0.45,	Adjusted R-squared:  0.34 
F-statistic: 4.091 on 2 and 10 DF,  p-value: 0.05033 

R> 
R> 
R> ###################################################
R> ### chunk number 11: BCG-Latitude-plot
R> ###################################################
R> plot(y ~ Latitude, data = BCG, ylab = "Estimated log-OR")
R> abline(lm(y ~ Latitude, data = BCG, weights = studyweights))
R> 
R> 
R> ###################################################
R> ### chunk number 12: MA-funnel-ex
R> ###################################################
R> set.seed(290875)
R> sigma <- seq(from = 1/10, to = 1, length.out = 35)
R> y <- rnorm(35) * sigma
R> gr <- (y > -0.5)
R> layout(matrix(1:2, ncol = 1))
R> plot(y, 1/sigma, xlab = "Effect size", ylab = "1 / standard error")
R> plot(y[gr], 1/(sigma[gr]), xlim = range(y),
+      xlab = "Effect size", ylab = "1 / standard error")
R> 
R> 
R> ###################################################
R> ### chunk number 13: MA-smoking-funnel
R> ###################################################
R> funnelplot(smokingDSL$logs, smokingDSL$selogs, summ = smokingDSL$logDSL,
+ xlim = c(-1.7, 1.7))
R> abline(v = 0, lty = 2)
R> 
R> 
R> 
